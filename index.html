<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A simple Sudoku game with multiple difficulty levels">
    <meta name="theme-color" content="#2c3e50">
    <title>Sudoku Game</title>
    <link rel="stylesheet" href="/styles.css">
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/svg+xml" href="/icon.svg">
</head>
<body>
    <div id="app">
        <!-- Debug Banner -->
        <div id="debug-banner" class="debug-banner" role="status" aria-live="polite" style="display:none;">
            <span id="debug-message"></span>
            <button id="debug-dismiss" aria-label="Dismiss debug" type="button">×</button>
        </div>
        
        <!-- Start Screen -->
        <div id="start-screen" class="screen active">
            <h1>Sudoku</h1>
            <div class="difficulty-buttons">
                <button type="button" class="difficulty-btn" data-difficulty="easy" onclick="(function(){ if(window.startGame) return window.startGame('easy'); if(typeof SudokuGame === 'function' && !window.__sudoku){ window.__sudoku = new SudokuGame(); if(window.__sudoku && typeof window.__sudoku.startGame==='function'){ return window.__sudoku.startGame('easy'); }} const dbg = document.getElementById('debug-banner'); const msg = document.getElementById('debug-message'); if(dbg && msg){ msg.textContent = 'App not fully loaded. Try refreshing or wait a moment.'; dbg.style.display = 'block'; } })()">Easy</button>
                <button type="button" class="difficulty-btn" data-difficulty="medium" onclick="(function(){ if(window.startGame) return window.startGame('medium'); if(typeof SudokuGame === 'function' && !window.__sudoku){ window.__sudoku = new SudokuGame(); if(window.__sudoku && typeof window.__sudoku.startGame==='function'){ return window.__sudoku.startGame('medium'); }} const dbg = document.getElementById('debug-banner'); const msg = document.getElementById('debug-message'); if(dbg && msg){ msg.textContent = 'App not fully loaded. Try refreshing or wait a moment.'; dbg.style.display = 'block'; } })()">Medium</button>
                <button type="button" class="difficulty-btn" data-difficulty="hard" onclick="(function(){ if(window.startGame) return window.startGame('hard'); if(typeof SudokuGame === 'function' && !window.__sudoku){ window.__sudoku = new SudokuGame(); if(window.__sudoku && typeof window.__sudoku.startGame==='function'){ return window.__sudoku.startGame('hard'); }} const dbg = document.getElementById('debug-banner'); const msg = document.getElementById('debug-message'); if(dbg && msg){ msg.textContent = 'App not fully loaded. Try refreshing or wait a moment.'; dbg.style.display = 'block'; } })()">Hard</button>
                <button type="button" class="difficulty-btn" data-difficulty="expert" onclick="(function(){ if(window.startGame) return window.startGame('expert'); if(typeof SudokuGame === 'function' && !window.__sudoku){ window.__sudoku = new SudokuGame(); if(window.__sudoku && typeof window.__sudoku.startGame==='function'){ return window.__sudoku.startGame('expert'); }} const dbg = document.getElementById('debug-banner'); const msg = document.getElementById('debug-message'); if(dbg && msg){ msg.textContent = 'App not fully loaded. Try refreshing or wait a moment.'; dbg.style.display = 'block'; } })()">Expert</button>
            </div>
            <div class="leaderboard-section">
                <h2>Leaderboard</h2>
                <div id="leaderboard-display"></div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <div class="game-header">
                <button id="back-btn" class="btn-secondary">← Back</button>
                <div class="game-info">
                    <span id="difficulty-display"></span>
                    <span id="timer-display">00:00</span>
                </div>
            </div>
            <div id="sudoku-grid"></div>
            <div class="message" id="game-message"></div>
            
            <!-- Number Pad for Touch Devices -->
            <div id="number-pad" class="number-pad">
                <button type="button" class="number-btn" data-number="1" aria-label="Enter number 1">1</button>
                <button type="button" class="number-btn" data-number="2" aria-label="Enter number 2">2</button>
                <button type="button" class="number-btn" data-number="3" aria-label="Enter number 3">3</button>
                <button type="button" class="number-btn" data-number="4" aria-label="Enter number 4">4</button>
                <button type="button" class="number-btn" data-number="5" aria-label="Enter number 5">5</button>
                <button type="button" class="number-btn" data-number="6" aria-label="Enter number 6">6</button>
                <button type="button" class="number-btn" data-number="7" aria-label="Enter number 7">7</button>
                <button type="button" class="number-btn" data-number="8" aria-label="Enter number 8">8</button>
                <button type="button" class="number-btn" data-number="9" aria-label="Enter number 9">9</button>
                <button type="button" class="number-btn clear-btn" data-number="0" aria-label="Clear cell">Clear</button>
            </div>
        </div>
    </div>

    <script src="/sudoku-generator.js"></script>
    <script src="/app.js"></script>
    <!-- Unregister old service workers on load (hotfix to ensure fresh assets) -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', async () => {
          try {
            const regs = await navigator.serviceWorker.getRegistrations();
            for (const reg of regs) {
              await reg.unregister();
              console.log('Service worker unregistered (hotfix):', reg);
            }
            // Optional: reload so the page loads latest network assets
            if (regs.length) {
              window.location.reload(true);
            }
          } catch (err) {
            console.warn('Failed to unregister service workers:', err);
          }
        });
      }
    </script>
    <script>
        // Register service worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed'));
            });
        }
    </script>
</body>
</html>
